<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Lato|Raleway&display=swap" rel="stylesheet">
</head>
<style media="screen">
  body {
    margin: 0;
    padding: 0;
    background-color: #f5f5f5;
    overflow: hidden;
    -webkit-font-smoothing: antialiased;
    font-family: 'Lato', sans-serif;
  }

  header {
    position: absolute;
    width: 100%;
    height: 70px;
    background: white;
    box-shadow: 0px 2px 5px rgba(0,0,0,0.1);
    display: inline-flex;
    line-height: 70px;
  }
  
  header img {
    height: 35px;
    margin-top: 17.5px;
    margin-left: 30px;
  }
  
  h2 {
    font-size: 18px;
    line-height: 1.2;
    color: #222;
  }
  
  .title {
    font-weight: 600;
  }
  
  h1 {
    font-family: 'Raleway', serif;
    margin: 0px;
    color: #222;
    margin-left: 20px;
    font-weight: 300;
    font-size: 22px;
  }
  
  main {
    height: 100vh;
    width: 100%;
  }
  
  .seperator {
    width: 1px;
    background: #ccc;
    float: right;
    height: 25px;
    margin: 22.5px 0px 0 15px;
  }
  .control-box {
    position: absolute;
    width: 305px;
    top: 115px;
    left: 20px;
    color: #222;
    z-index: 1000;
    padding: 20px;
    border-radius: 5px;
    pointer-events: none;
    overflow-y: auto;
  }
  
  .tooltip {
    display: none;
    background: rgba(255, 255, 255, 0.9);
    border-left: 5px solid #61c9ab;
    margin-left: 28px;
    padding: 10px;
    position: absolute;
    z-index: 1000;
    width: 200px;
    height: 100px;
  }
</style>

<body>
  <header>
    <img src="assets/sustainbeef.png" alt="SustainBeef Logo">
    <h1 class="title" >SustainBeef</h1>
    <div class="seperator"></div>
    <h1>Base line system performances results</h1>
  </header>
  <main>
    <span class="control-box">
      <h2>Deliverable 3.3</h2>
    </span>
    <svg id="europe_sustainbeef" height="100%" width="100%"></svg>
    <div class="tooltip">
      <h2 id="tpHeader"></h2>
    </div>
  </main>
</body>
<script>
  const regions = {
    'BE34': 'BE-CC1',
    'BE35': 'BE-CC2',
    'BE32': 'BE-BF',
    'BE33': 'BE-D',
    'FRK1': 'FR.CANT-CC',
    'FRI2': 'FR.LIM-CC',
    'FRK2': 'FR.CANT-DCC',
    'FRF3': 'FR.LOR-BF',
    'DE21': 'GE.BAV-F',
    'DEA3': 'GE.LS-F',
    'DEA5': 'GE.NRW-DF',
    'IE04': 'IE.NRW',
    'IE06': 'IE.SE',
    'ITH3': 'IT-F.226',
    'ITH2': 'IT-F.900'
  }

  const countries = ['BE', 'DE', 'FR', 'IT', 'IE']

  var tooltip = document.querySelectorAll('.tooltip')[0];
  var tpHeader = document.getElementById('tpHeader')
  document.addEventListener('mousemove', fn, false);

  function fn(e) {
    tooltip.style.left = e.pageX + 'px';
    tooltip.style.top = e.pageY + 'px';
  }
  // The svg
  var svg = d3.select("svg"),
    width = window.innerWidth // +svg.attr("width"), // /
  height = window.innerHeight // +svg.attr("height"); // 

  svg.attr("viewBox", "0 0 " + width + " " + height);
  // Map and projection
  var path = d3.geoPath();
  var projection = d3.geoMercator()
    .scale(2000)
    .center([0, 49])
    .translate([width / 2, height / 2]);

  // Data and color scale
  var data = d3.map();
  var colorScale = d3.scaleThreshold()
    .domain([100000, 1000000, 10000000, 30000000, 100000000, 500000000])
    .range(d3.schemeBlues[7]);

  // Load external data and boot
  d3.queue()
    .defer(d3.json, "https://raw.githubusercontent.com/eurostat/Nuts2json/master/2016/4258/20M/nutsrg_2.json")
    // .defer(d3.csv, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world_population.csv", function(d) { data.set(d.code, +d.pop); })
    .await(ready);

  function ready(error, topo) {
    let mouseOver = function(d) {
      const nuts2 = d.properties.id
      if (!(nuts2 in regions)) return
      // update tooltip info
      tpHeader.innerHTML = regions[nuts2]
      // show tooltip
      tooltip.style.display = 'block'
      d3.selectAll(".Country")
        .transition()
        .duration(200)
        .style("opacity", .5)
      d3.select(this)
        .transition()
        .duration(200)
        .style("opacity", 1)
    }

    let mouseLeave = function(d) {
      // hide tooltip when SustainBeef NUTS3 is left
      tooltip.style.display = 'none'
      d3.selectAll(".Country")
        .transition()
        .duration(200)
        .style("opacity", .8)
      d3.select(this)
        .transition()
        .duration(200)
        .style("opacity", .8)
    }

    // Draw the map
    svg.append("g")
      .selectAll("path")
      .data(topo.features)
      .enter()
      .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection)
      )
      // set the color of each country
      .attr("fill", d => {
        const nuts2 = d.properties.id
        const country = d.properties.id.substring(0, 2)
        if (nuts2 in regions) {
          return '#f19d0d'
        } else if (countries.includes(country)) {
          return '#e3e3e3'
        }
        return '#ececec';
      })
      .style("stroke", d => {
        const nuts2 = d.properties.id
        if (nuts2 in regions) {
          return 'white'
        }
        return 'transparent'
      })
      .attr("class", function(d) {
        return "Country"
      })
      .style("opacity", .8)
      .on("mouseover", mouseOver)
      .on("mouseleave", mouseLeave)
  }
</script>

</html>